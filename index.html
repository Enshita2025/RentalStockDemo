<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>レンタカー在庫カレンダー（社員用）</title>
  <style>
    :root{
      --bg:#0f172a;           /* slate-900 */
      --panel:#111827;        /* gray-900 */
      --muted:#94a3b8;        /* slate-400 */
      --text:#e5e7eb;         /* gray-200 */
      --accent:#22c55e;       /* green-500 */
      --grid:#1f2937;         /* gray-800 */
      --warn:#f59e0b;         /* amber-500 */
      --danger:#ef4444;       /* red-500 */
      --ok:#10b981;           /* emerald-500 */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      background:linear-gradient(180deg, var(--bg), #0b1220);
      color:var(--text);
    }
    header{
      position:sticky; top:0; z-index:10; backdrop-filter: blur(6px);
      background:rgba(15,23,42,.85); border-bottom:1px solid #1f2937;
    }
    .wrap{max-width:1100px; margin:0 auto; padding:12px 14px}
    h1{font-size:20px; margin:6px 0 2px}
    .sub{color:var(--muted); font-size:12px}

    .toolbar{display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin:10px 0}
    button{
      background:#111827; color:var(--text); border:1px solid #334155; padding:8px 10px; border-radius:10px; cursor:pointer;
      transition:.15s transform ease, .15s background ease; font-size:14px;
    }
    button:hover{background:#0b1220; transform:translateY(-1px)}

    .tabs{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px }
    .tab{ padding:6px 10px; border-radius:999px; border:1px solid #334155; color:var(--muted); background:#0b1220; cursor:pointer; font-size:13px }
    .tab.active{ color:#052b12; background:linear-gradient(135deg,#22c55e,#86efac); border-color:transparent; font-weight:700 }

    .panel{background:var(--panel); border:1px solid #1f2937; border-radius:14px; padding:12px}

    .scroller{ overflow-x:auto; -webkit-overflow-scrolling: touch; border-radius:12px; }
    .grid { min-width:320px; display:grid; grid-template-columns: 1fr; border:1px solid var(--grid); border-radius:12px; overflow:hidden }
    .grid .head { 
      background:#0b1220; 
      border-bottom:1px solid var(--grid); 
      display:grid; 
      grid-template-columns: repeat(7,96px); /* 120%に拡大 */
    }
    .grid .head > div {
      text-align: center;
      width: 96px;         /* 120%に拡大 */
      margin: 5px auto;
      box-sizing: border-box;
      padding-left: 0;
      padding-right: 0;
    }
    .cell {
      display: grid;
      grid-template-columns: repeat(7, 96px); /* 120%に拡大 */
      border-top: 1px solid var(--grid);
      border-left: 1px solid var(--grid);
      padding: 0;
      min-height: 160px;
      position: relative;
    }
    .cell > div {
      margin-left: 10px;
      margin-right: 10px;
    }
    .cell .blk{ 
      margin:5px auto;
      width:96px;          /* 120%に拡大 */
      min-width:0;
      max-width:100%;
    }
    .cell .memo{ position:absolute; right:8px; top:8px; font-size:12px; color:var(--muted) }

    .blk{ display:grid; grid-template-rows: auto auto auto; gap:2px; padding:6px 8px; border:1px dashed #2a3a50; border-radius:8px }
    .blk + .blk{ margin-top:3px }
    .lbl{ font-weight:700; letter-spacing:.02em }
    .ln{ font-size:13px; color:var(--muted) }

    .blk .lbl, .blk .ln {
      color: #000;
    }

    .ok{ background:linear-gradient(180deg, rgba(16,185,129,.06), rgba(16,185,129,.02)) }
    .warn{ background:linear-gradient(180deg, rgba(245,158,11,.08), rgba(245,158,11,.02)) }
    .danger{ background:linear-gradient(180deg, rgba(239,68,68,.08), rgba(239,68,68,.02)) }

    .legend{ display:flex; gap:10px; flex-wrap:wrap; font-size:12px; color:var(--muted) }

    @media(max-width:980px){
      .grid{ min-width:680px }
      .cell{ min-height:180px }
      .wrap{ padding:10px 10px }
    }
    @media(max-width:520px){
      h1{font-size:18px}
      .tab{ padding:5px 10px; font-size:12px }
      .blk{ padding:6px }
      .ln{ font-size:12px }
    }

    @media print{
      header,.toolbar,.panel.controls,.tabs{ display:none }
      body{ background:#fff; color:#000 }
      .grid, .cell, .head{ border-color:#aaa }
    }

    /* 追加スタイル */
    .bg-kei { background:linear-gradient(180deg,#e6fbe7,#d1fae5); }
    .bg-komagata { background:linear-gradient(180deg,#e6f3fb,#dbeafe); }
    .bg-minivan { background:linear-gradient(180deg,#fbe6f3,#fce7f3); }
    .bg-boxy { background:linear-gradient(180deg,#fbfbe6,#fef9c3); }

    .tab-kei { background: #e6fbe7; color: #052b12; }
    .tab-kei.active { background: linear-gradient(135deg,#22c55e,#16a34a); color: #fff; }

    .tab-komagata { background: #e6f3fb; color: #1e293b; }
    .tab-komagata.active { background: linear-gradient(135deg,#2563eb,#38bdf8); color: #fff; }

    .tab-minivan { background: #fbe6f3; color: #831843; }
    .tab-minivan.active { background: linear-gradient(135deg,#db2777,#f472b6); color: #fff; }

    .tab-boxy { background: #fbfbe6; color: #92400e; }
    .tab-boxy.active { background: linear-gradient(135deg,#facc15,#fde68a); color: #fff; }

    .head .sat { color: #2563eb; }   /* 土曜：青 */
    .head .sun, .head .holiday { color: #ef4444; } /* 日曜・祝日：赤 */
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>レンタカー在庫カレンダー（社員用）</h1>
    <div class="sub">車種ごとに在庫状況が確認できます。本番では予約サイトの予約件数に合わせた表記になりますが、今回はデモなので仮の台数で表示しています</div>
    <div class="toolbar">
      <button id="prevWeek">◀ 先週</button>
      <button id="today">今週</button>
      <button id="nextWeek">来週 ▶</button>
    </div>
  </div>
</header>

<main class="wrap">
  <section class="panel controls" aria-label="設定とタブ">
    <div class="legend" style="justify-content:space-between; align-items:end">
      <div>
        <!-- <div style="font-weight:700">週：<span id="weekLabel">YYYY/MM/DD 〜 YYYY/MM/DD</span></div> -->
      </div>
    </div>
    <div class="tabs" id="tabs"></div>
  </section>

  <section class="panel" aria-label="在庫カレンダー">
    <div class="scroller">
      <div class="grid" id="calendar"><!-- built by JS --></div>
    </div>
  </section>
</main>

<script>
(() => {
  const selKEY = 'seki-rentacar-selected-cat';
  // 表示用設定（固定）
  const cfg = {
    slots: [ { id:'AM', name:'AM' }, { id:'PM', name:'PM' } ],
    categories: [
      { id:'A', name:'軽自動車', fleet:5 },
      { id:'B', name:'小型普通', fleet:4 },
      { id:'C', name:'ミニバン', fleet:3 },
      { id:'D', name:'BOXY', fleet:2 }
    ]
  };

  // デモ用データ（閲覧専用・固定値）
  // 実装時はこの部分をAPI結果で置き換え
  const demoData = (() => {
    const today = new Date();
    const monday = startOfWeek(today);
    const obj = {};
    for(let i=0; i<7; i++){
      const d = new Date(monday); d.setDate(d.getDate()+i);
      const k = iso(d);
      obj[k] = { AM:{}, PM:{}, memo:'' };
      // 予約台数（0～3のランダム値）
      obj[k].AM = {
        A: (() => { let n = Math.floor(Math.random()*4); return n; })(),
        B: (() => { let n = Math.floor(Math.random()*4); return n; })(),
        C: (() => { let n = Math.floor(Math.random()*2); return n; })(),
        D: (() => { let n = Math.floor(Math.random()*1); return n; })()
      };
      obj[k].PM = {
        A: (() => { let n = Math.floor(Math.random()*4); return n; })(),
        B: (() => { let n = Math.floor(Math.random()*4); return n; })(),
        C: (() => { let n = Math.floor(Math.random()*2); return n; })(),
        D: (() => { let n = Math.floor(Math.random()*1); return n; })()
      };
      // 在庫台数（合計固定値になるように）
      obj[k].AM.A = { need: obj[k].AM.A, stock: 5 - obj[k].AM.A };
      obj[k].AM.B = { need: obj[k].AM.B, stock: 3 - obj[k].AM.B };
      obj[k].AM.C = { need: obj[k].AM.C, stock: 2 - obj[k].AM.C };
      obj[k].AM.D = { need: obj[k].AM.D, stock: 1 - obj[k].AM.D };
      obj[k].PM.A = { need: obj[k].PM.A, stock: 5 - obj[k].PM.A };
      obj[k].PM.B = { need: obj[k].PM.B, stock: 3 - obj[k].PM.B };
      obj[k].PM.C = { need: obj[k].PM.C, stock: 2 - obj[k].PM.C };
      obj[k].PM.D = { need: obj[k].PM.D, stock: 1 - obj[k].PM.D };
    }
    return obj;
  })();

  function startOfWeek(d){ const x = new Date(d.getFullYear(), d.getMonth(), d.getDate()); const day = (x.getDay()+6)%7; x.setDate(x.getDate()-day); x.setHours(0,0,0,0); return x; }
  function fmtMD(d){ const wd = ['月','火','水','木','金','土','日'][ (d.getDay()+6)%7 ]; return `${d.getMonth()+1}/${d.getDate()} (${wd})`; }
  function iso(d){ return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; }

  let anchor = startOfWeek(new Date());
  let selectedCatId = localStorage.getItem(selKEY) || cfg.categories[0].id;

  // const weekLabel = document.getElementById('weekLabel');
  const calendar = document.getElementById('calendar');
  const prevWeekBtn = document.getElementById('prevWeek');
  const nextWeekBtn = document.getElementById('nextWeek');
  const todayBtn = document.getElementById('today');
  const tabs = document.getElementById('tabs');

  function weekDates(){
    // 月曜～日曜の配列を返す
    const arr = [];
    for(let i=0;i<7;i++){
      const d = new Date(anchor); d.setDate(d.getDate()+i);
      arr.push(d);
    }
    return arr;
  }

  function buildTabsUI(){
    tabs.innerHTML = '';
    cfg.categories.forEach(c => {
      let colorClass = '';
      switch(c.id){
        case 'A': colorClass = 'tab-kei'; break;
        case 'B': colorClass = 'tab-komagata'; break;
        case 'C': colorClass = 'tab-minivan'; break;
        case 'D': colorClass = 'tab-boxy'; break;
      }
      const b = document.createElement('button');
      b.className = `tab ${colorClass}` + (c.id===selectedCatId?' active':'');
      b.textContent = `${c.name}`;
      b.onclick = () => { selectedCatId = c.id; localStorage.setItem(selKEY, selectedCatId); render(); };
      tabs.appendChild(b);
    });
  }

  // 祝日判定（例：2025年の一部祝日）
  function isHoliday(d){
    const holidays = [
      '2025-01-01','2025-01-13','2025-02-11','2025-02-23','2025-03-20',
      '2025-04-29','2025-05-03','2025-05-04','2025-05-05','2025-05-06',
      '2025-07-21','2025-08-11','2025-09-15','2025-09-23','2025-10-13',
      '2025-11-03','2025-11-23','2025-12-23'
    ];
    return holidays.includes(iso(d));
  }

  function render(){
    buildTabsUI();
    const dates = weekDates();
    // weekLabel.textContent = `${fmtMD(dates[0])} 〜 ${fmtMD(dates[6])}`;

    // パネルの背景色切り替え
    const panel = document.querySelector('.panel[aria-label="在庫カレンダー"]');
    panel.classList.remove('bg-kei','bg-komagata','bg-minivan','bg-boxy');
    switch(selectedCatId){
      case 'A': panel.classList.add('bg-kei'); break;
      case 'B': panel.classList.add('bg-komagata'); break;
      case 'C': panel.classList.add('bg-minivan'); break;
      case 'D': panel.classList.add('bg-boxy'); break;
    }

    // ヘッダー（1週間分）
    const head = document.createElement('div');
    head.className = 'head';
    dates.forEach(d => {
      const dv = document.createElement('div');
      let cls = '';
      if(isHoliday(d)){
        cls = 'holiday';
      }else{
        const wd = d.getDay();
        if(wd === 0) cls = 'sun';
        else if(wd === 6) cls = 'sat';
      }
      dv.innerHTML = `<div class="${cls}" style="font-weight:700">${fmtMD(d)}</div>`;
      head.appendChild(dv);
    });

    // 1週間分のセル
    const row = document.createElement('div');
    row.className = 'row1';

    const cell = document.createElement('div');
    cell.className = 'cell';

    dates.forEach(d => {
      const k = iso(d);

      // AM
      const needAM = demoData[k]?.AM?.[selectedCatId]?.need ?? 0;
      const restAM = demoData[k]?.AM?.[selectedCatId]?.stock ?? 0;

      // PM
      const needPM = demoData[k]?.PM?.[selectedCatId]?.need ?? 0;
      const restPM = demoData[k]?.PM?.[selectedCatId]?.stock ?? 0;

      // 各日ごとに午前/午後を縦並びで配置
      const dayDiv = document.createElement('div');
      dayDiv.style.display = 'flex';
      dayDiv.style.flexDirection = 'column';
      dayDiv.innerHTML = `
        <div class="blk">
          <div class="lbl">午前</div>
          <div class="ln">予約: ${needAM}台</div>
          <div class="ln">在庫: ${restAM}台</div>
        </div>
        <div class="blk">
          <div class="lbl">午後</div>
          <div class="ln">予約: ${needPM}台</div>
          <div class="ln">在庫: ${restPM}台</div>
        </div>
      `;
      cell.appendChild(dayDiv);
    });

    row.appendChild(cell);

    calendar.innerHTML = '';
    calendar.appendChild(head);
    calendar.appendChild(row);
  }

  // 週移動
  prevWeekBtn.onclick = () => { anchor.setDate(anchor.getDate()-7); render(); };
  nextWeekBtn.onclick = () => { anchor.setDate(anchor.getDate()+7); render(); };
  todayBtn.onclick = () => { anchor = startOfWeek(new Date()); render(); };

  render();
})();
</script>
</body>
</html>
