<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>社員向け 在庫カレンダー（閲覧用・クラス別タブ）</title>
  <style>
    :root{
      --bg:#0f172a;           /* slate-900 */
      --panel:#111827;        /* gray-900 */
      --muted:#94a3b8;        /* slate-400 */
      --text:#e5e7eb;         /* gray-200 */
      --accent:#22c55e;       /* green-500 */
      --grid:#1f2937;         /* gray-800 */
      --warn:#f59e0b;         /* amber-500 */
      --danger:#ef4444;       /* red-500 */
      --ok:#10b981;           /* emerald-500 */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      background:linear-gradient(180deg, var(--bg), #0b1220);
      color:var(--text);
    }
    header{
      position:sticky; top:0; z-index:10; backdrop-filter: blur(6px);
      background:rgba(15,23,42,.85); border-bottom:1px solid #1f2937;
    }
    .wrap{max-width:1100px; margin:0 auto; padding:12px 14px}
    h1{font-size:20px; margin:6px 0 2px}
    .sub{color:var(--muted); font-size:12px}

    .toolbar{display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin:10px 0}
    button{
      background:#111827; color:var(--text); border:1px solid #334155; padding:8px 10px; border-radius:10px; cursor:pointer;
      transition:.15s transform ease, .15s background ease; font-size:14px;
    }
    button:hover{background:#0b1220; transform:translateY(-1px)}

    .tabs{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px }
    .tab{ padding:6px 10px; border-radius:999px; border:1px solid #334155; color:var(--muted); background:#0b1220; cursor:pointer; font-size:13px }
    .tab.active{ color:#052b12; background:linear-gradient(135deg,#22c55e,#86efac); border-color:transparent; font-weight:700 }

    .panel{background:var(--panel); border:1px solid #1f2937; border-radius:14px; padding:12px}

    .scroller{ overflow-x:auto; -webkit-overflow-scrolling: touch; border-radius:12px; }
    .grid{ min-width:720px; display:grid; grid-template-columns: repeat(7,1fr); border:1px solid var(--grid); border-radius:12px; overflow:hidden }
    .grid .head{ background:#0b1220; border-bottom:1px solid var(--grid); display:grid; grid-template-columns: repeat(7,1fr)}
    .grid .head div{ padding:10px; text-align:center; border-left:1px solid var(--grid)}
    .grid .head div:first-child{border-left:none}

    .row1{ display:grid; grid-template-columns: repeat(7,1fr) }
    .cell{ border-top:1px solid var(--grid); border-left:1px solid var(--grid); padding:10px; min-height:160px; position:relative }
    .row1 .cell:first-child{ border-left:none }
    .cell .memo{ position:absolute; right:8px; top:8px; font-size:12px; color:var(--muted) }

    .blk{ display:grid; grid-template-rows: auto auto auto; gap:2px; padding:6px 8px; border:1px dashed #2a3a50; border-radius:8px }
    .blk + .blk{ margin-top:8px }
    .lbl{ font-weight:700; letter-spacing:.02em }
    .ln{ font-size:13px; color:var(--muted) }

    .ok{ background:linear-gradient(180deg, rgba(16,185,129,.06), rgba(16,185,129,.02)) }
    .warn{ background:linear-gradient(180deg, rgba(245,158,11,.08), rgba(245,158,11,.02)) }
    .danger{ background:linear-gradient(180deg, rgba(239,68,68,.08), rgba(239,68,68,.02)) }

    .legend{ display:flex; gap:10px; flex-wrap:wrap; font-size:12px; color:var(--muted) }
    .legend .e{ display:flex; gap:6px; align-items:center }

    @media(max-width:980px){
      .grid{ min-width:680px }
      .cell{ min-height:180px }
      .wrap{ padding:10px 10px }
    }
    @media(max-width:520px){
      h1{font-size:18px}
      .tab{ padding:5px 10px; font-size:12px }
      .blk{ padding:6px }
      .ln{ font-size:12px }
    }

    @media print{
      header,.toolbar,.panel.controls,.tabs{ display:none }
      body{ background:#fff; color:#000 }
      .grid, .cell, .head{ border-color:#aaa }
    }
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>社員向け 在庫カレンダー（閲覧用｜クラス別タブ）</h1>
    <div class="sub">AM/PMの2枠を1セルにまとめて表示。<strong>閲覧専用</strong>です（編集UIなし）。</div>
    <div class="toolbar">
      <button id="prevWeek">◀ 先週</button>
      <button id="today">今週</button>
      <button id="nextWeek">来週 ▶</button>
    </div>
  </div>
</header>

<main class="wrap">
  <section class="panel controls" aria-label="設定とタブ">
    <div class="legend" style="justify-content:space-between; align-items:end">
      <div>
        <div style="font-weight:700">週：<span id="weekLabel">YYYY/MM/DD 〜 YYYY/MM/DD</span></div>
      </div>
      <div>
        <span class="e">残数OK → 緑</span>
        <span class="e">残数0 → 黄</span>
        <span class="e">超過 → 赤</span>
      </div>
    </div>
    <div class="tabs" id="tabs"></div>
  </section>

  <section class="panel" aria-label="在庫カレンダー">
    <div class="scroller">
      <div class="grid" id="calendar"><!-- built by JS --></div>
    </div>
  </section>
</main>

<script>
(() => {
  const selKEY = 'seki-rentacar-selected-cat';
  // 表示用設定（固定）
  const cfg = {
    slots: [ { id:'AM', name:'AM' }, { id:'PM', name:'PM' } ],
    categories: [
      { id:'A', name:'軽', fleet:5 },
      { id:'B', name:'コンパクト', fleet:4 },
      { id:'C', name:'ミニバン', fleet:3 },
      { id:'D', name:'軽トラック', fleet:2 }
    ]
  };

  // デモ用データ（閲覧専用・固定値）
  // 実装時はこの部分をAPI結果で置き換え
  const demoData = (()=>{
    const today = new Date();
    const monday = startOfWeek(today);
    const obj = {};
    for(let i=0;i<7;i++){
      const d = new Date(monday); d.setDate(d.getDate()+i);
      const k = iso(d);
      obj[k] = { AM:{}, PM:{}, memo:'' };
      // 適当な値
      obj[k].AM = { A:1, B:2, C:1, D:0 };
      obj[k].PM = { A:0, B:1, C:1, D:0 };
    }
    return obj;
  })();

  function startOfWeek(d){ const x = new Date(d.getFullYear(), d.getMonth(), d.getDate()); const day = (x.getDay()+6)%7; x.setDate(x.getDate()-day); x.setHours(0,0,0,0); return x; }
  function fmtMD(d){ const wd = ['月','火','水','木','金','土','日'][ (d.getDay()+6)%7 ]; return `${d.getMonth()+1}/${d.getDate()} (${wd})`; }
  function iso(d){ return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; }

  let anchor = startOfWeek(new Date());
  let selectedCatId = localStorage.getItem(selKEY) || cfg.categories[0].id;

  const weekLabel = document.getElementById('weekLabel');
  const calendar = document.getElementById('calendar');
  const prevWeekBtn = document.getElementById('prevWeek');
  const nextWeekBtn = document.getElementById('nextWeek');
  const todayBtn = document.getElementById('today');
  const tabs = document.getElementById('tabs');

  function weekDates(){ return Array.from({length:7}, (_,i)=>{ const d = new Date(anchor); d.setDate(d.getDate()+i); return d; }); }

  function buildTabsUI(){
    tabs.innerHTML = '';
    cfg.categories.forEach(c => {
      const b = document.createElement('button');
      b.className = 'tab' + (c.id===selectedCatId?' active':'');
      b.textContent = `${c.name}（${c.id}）`;
      b.onclick = () => { selectedCatId = c.id; localStorage.setItem(selKEY, selectedCatId); render(); };
      tabs.appendChild(b);
    });
  }

  function render(){
    buildTabsUI();
    const dates = weekDates();
    weekLabel.textContent = `${fmtMD(dates[0])} 〜 ${fmtMD(dates[6])}`;

    const head = document.createElement('div');
    head.className = 'head';
    dates.forEach(d => {
      const dv = document.createElement('div');
      dv.innerHTML = `<div style="font-weight:700">${fmtMD(d)}</div>`;
      head.appendChild(dv);
    });

    const row = document.createElement('div');
    row.className = 'row1';

    dates.forEach(d => {
      const k = iso(d);
      const cell = document.createElement('div');
      cell.className = 'cell';

      // AM
      const needAM = demoData[k]?.AM?.[selectedCatId] ?? 0;
      const fleetAM = (cfg.categories.find(c=>c.id===selectedCatId)?.fleet) ?? 0;
      const restAM = fleetAM - needAM;
      const clsAM = restAM < 0 ? 'danger' : (restAM===0 ? 'warn' : 'ok');

      // PM
      const needPM = demoData[k]?.PM?.[selectedCatId] ?? 0;
      const fleetPM = fleetAM; // 同一クラス
      const restPM = fleetPM - needPM;
      const clsPM = restPM < 0 ? 'danger' : (restPM===0 ? 'warn' : 'ok');

      cell.innerHTML = `
        <div class="blk ${clsAM}">
          <div class="lbl">AM</div>
          <div class="ln">予約: ${needAM}台</div>
          <div class="ln">在庫: ${fleetAM}台</div>
        </div>
        <div class="blk ${clsPM}">
          <div class="lbl">PM</div>
          <div class="ln">予約: ${needPM}台</div>
          <div class="ln">在庫: ${fleetPM}台</div>
        </div>
      `;

      row.appendChild(cell);
    });

    calendar.innerHTML = '';
    calendar.appendChild(head);
    calendar.appendChild(row);
  }

  // 週移動
  prevWeekBtn.onclick = () => { anchor.setDate(anchor.getDate()-7); render(); };
  nextWeekBtn.onclick = () => { anchor.setDate(anchor.getDate()+7); render(); };
  todayBtn.onclick = () => { anchor = startOfWeek(new Date()); render(); };

  render();
})();
</script>
</body>
</html>
